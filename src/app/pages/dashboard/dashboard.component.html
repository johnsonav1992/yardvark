<page-container pageTitle="Dashboard" [hideBackButton]="true">
  <ng-template #action1>
    <div class="header-actions">
      @if (hasHiddenWidgets()) {
        <p-button
          icon="ti ti-eye-off"
          [text]="true"
          size="small"
          severity="secondary"
          (onClick)="openHiddenWidgetsSidebar()"
          [label]="hiddenWidgetNames().length + ' hidden'"
        />
      }
      <p-button
        icon="ti ti-search"
        outlined
        [size]="isMobile() ? 'small' : 'large'"
        severity="secondary"
        (onClick)="openEntrySearchSidebar()"
        [label]="isMobile() ? 'Search' : 'Search for entries'"
      />
    </div>
  </ng-template>
  @if (userIsNewWithNoEntries()) {
    <p-message
      icon="ti ti-comet"
      text="Welcome to Yardvark! Click below to create your first entry."
      severity="success"
    />
  }
  @if (!userHasALocation() && !isLocationLoading()) {
    <p-message
      icon="ti ti-info-circle"
      text="It looks like you haven't set your location yet! Go to settings to set your location and start receiving soil temperature data."
      severity="warn"
    />
  }
  @if (allWidgetsHidden()) {
    <div class="all-widgets-hidden">
      <i class="ti ti-eye-off"></i>
      <h3>All dashboard widgets are hidden</h3>
      <p>Click the button above to restore widgets to your dashboard.</p>
    </div>
  } @else {
    <div
      class="cards-container"
      cdkDropList
      (cdkDropListDropped)="onWidgetDrop($event)"
      cdkDropListOrientation="mixed"
    >
      @for (widgetId of orderedVisibleWidgets(); track widgetId) {
        <div
          cdkDrag
          [cdkDragDisabled]="isAnyWidgetLoading()"
          [cdkDragStartDelay]="0"
          class="widget-wrapper"
        >
          @switch (widgetId) {
            @case ("recent-entry") {
              @if (recentEntry.isLoading()) {
                <card-skeleton />
              } @else {
                <recent-entry (onHideWidget)="hideWidget('recent-entry')" />
              }
            }
            @case ("quick-stats") {
              @if (isQuickStatsLoading()) {
                <card-skeleton />
              } @else {
                <quick-stats (onHideWidget)="hideWidget('quick-stats')" />
              }
            }
            @case ("lawn-health-score") {
              @if (isLawnHealthScoreLoading()) {
                <card-skeleton />
              } @else {
                <lawn-health-score
                  (onHideWidget)="hideWidget('lawn-health-score')"
                />
              }
            }
            @case ("weather-card") {
              @if (isWeatherCardLoading()) {
                <card-skeleton />
              } @else {
                <weather-card (onHideWidget)="hideWidget('weather-card')" />
              }
            }
          }
        </div>
      }
    </div>
  }
  @if (isMobile()) {
    <p-speeddial
      icon="ti ti-plus"
      [model]="mobileSpeedDialMenu()"
      class="speed-dial"
    />
  }
</page-container>
<entry-search-sidebar [(isOpen)]="isEntrySearchSidebarOpen" />
<hidden-widgets-sidebar
  [isOpen]="isHiddenWidgetsSidebarOpen()"
  [hiddenWidgets]="hiddenWidgetNames()"
  (onToggleSidebar)="toggleHiddenWidgetsSidebar($event)"
  (onShowWidget)="showWidget($event)"
/>
