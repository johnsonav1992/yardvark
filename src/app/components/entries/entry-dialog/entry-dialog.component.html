<form [formGroup]="form" class="main-form">
  <div class="date-title-wrapper">
    <span class="input-wrapper">
      <p>Title:</p>
      <small class="error">*</small>
      <input pInputText formControlName="title" />
    </span>
    <span class="input-wrapper">
      <p>Date:</p>
      <small class="error">*</small>
      <p-datePicker [showIcon]="true" formControlName="date" />
    </span>
  </div>
  <div class="col-input-wrapper">
    Activities:
    <p-multiSelect
      [options]="activities()"
      [optionLabel]="'name'"
      formControlName="activities"
    />
  </div>
  <div class="col-input-wrapper">
    Lawn Segments:
    <p-multiSelect
      [options]="lawnSegments()"
      formControlName="lawnSegments"
      optionLabel="name"
    />
  </div>
  <div class="col-input-wrapper">
    Products:
    <p-multiSelect
      #productSelect
      [options]="products.value()"
      optionLabel="name"
      [placeholder]="products.isLoading() ? 'Loading...' : 'Select Products'"
      [loading]="products.isLoading()"
      [loadingIcon]="'ti ti-loader-2'"
      [showClear]="true"
      (onChange)="addProductToForm($event); productSelect.hide()"
      (onClear)="this.form.controls.products.clear()"
    >
      <ng-template let-product #item>
        <product-small-card [product]="product" [showBorder]="false" />
      </ng-template>
      <ng-template let-items #selecteditems>
        @if (items?.length) {
          {{ items.length }} selected
        }
      </ng-template>
    </p-multiSelect>
  </div>
  @let selectedProducts = form.controls.products.value;

  @if (selectedProducts?.length) {
    <div class="products-wrapper" formArrayName="products">
      @for (item of selectedProducts; track item.product?.id) {
        <div [formGroupName]="$index">
          <product-small-card [product]="item.product!">
            <ng-template #actions>
              <div class="product-input-wrapper">
                <p-inputNumber
                  [showButtons]="true"
                  [min]="0"
                  [max]="100"
                  [maxFractionDigits]="2"
                  mode="decimal"
                  [inputStyle]="{ width: '6rem' }"
                  formControlName="quantity"
                />
                <p-select
                  [options]="quantityUnits"
                  formControlName="quantityUnit"
                />
              </div>
            </ng-template>
          </product-small-card>
        </div>
      }
    </div>
  }
  <div class="col-input-wrapper">
    Notes:
    <textarea pTextarea [rows]="3" formControlName="notes"></textarea>
  </div>
</form>
