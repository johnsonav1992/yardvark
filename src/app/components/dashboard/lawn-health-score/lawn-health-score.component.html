<p-card>
  <ng-template #title>
    <div class="title-container">
      <div class="title-with-icon">
        <i class="ti ti-heart-handshake icon"></i>
        Lawn Health Score
        @if (isAiGenerated()) {
          <p-button
            #aiIndicator
            [text]="true"
            [rounded]="true"
            size="small"
            class="ai-indicator"
            (click)="op.toggle($event)"
            icon="ti ti-sparkles"
            severity="secondary"
          />
          <p-popover #op>
            <div class="ai-popover-content">
              <div class="ai-popover-header">
                <i class="ti ti-sparkles ai-icon"></i>
                <span class="ai-title">AI Generated</span>
              </div>
              <p class="ai-description">
                This description was generated by AI based on your lawn health
                score and current season. Please note that AI-generated content
                may not always be accurate or applicable to your specific lawn
                conditions.
              </p>
            </div>
          </p-popover>
        }
      </div>
      <div class="title-buttons">
        <p-button
          icon="ti ti-eye-off"
          [text]="true"
          [rounded]="true"
          size="small"
          severity="secondary"
          (onClick)="hideWidget()"
          [pTooltip]="'Hide this widget'"
          tooltipPosition="left"
        />
        <i
          class="ti ti-grip-vertical drag-handle"
          cdkDragHandle
          [pTooltip]="'Drag to reorder'"
          tooltipPosition="left"
        ></i>
      </div>
    </div>
  </ng-template>
  @if (lawnHealthScore().totalScore === 0 && !lawnHealthScore().isOffSeason) {
    <div class="empty-state">
      <i class="ti ti-seeding empty-icon"></i>
      @if (lawnHealthScore().description === 'No data available') {
        <h3>No Lawn Data Yet</h3>
        <p class="empty-description">
          Start tracking your lawn care activities to see your health score.
          Create your first entry to begin building your lawn care history!
        </p>
      } @else {
        <h3>Need More Data</h3>
        <p class="empty-description">
          You need at least 3 lawn care entries for an accurate health score.
          Keep adding entries to track your lawn care progress!
        </p>
      }
      <p-button
        label="Create Entry"
        icon="ti ti-plus"
        severity="success"
        (onClick)="navigateToCreateEntry()"
      />
    </div>
  } @else if (lawnHealthScore().isOffSeason) {
    <div class="off-season-state">
      <i class="ti ti-snowflake off-season-icon"></i>
      <h3>Off-Season</h3>
      <p class="off-season-description">
        Your lawn is currently dormant. Scoring will resume when the growing season begins based on your location and soil temperature.
      </p>
      <p class="off-season-tip">
        This is a great time to plan for next season, maintain your equipment, and review your lawn care goals!
      </p>
    </div>
  } @else {
    <div class="health-score-container">
      <div class="score-display">
        <div class="score-circle" [style.border-color]="scoreColor()">
          <span class="score-number">{{ lawnHealthScore().totalScore }}</span>
          <span class="score-grade">{{ lawnHealthScore().grade }}</span>
        </div>
        <p class="score-description">{{ finalDescription() }}</p>
      </div>
      <p-divider [dt]="dividerDt" />
      <div class="breakdown-container">
        <div class="breakdown-item">
          <span class="breakdown-label">
            <i class="li li-lawnmower breakdown-icon"></i>
            Mowing
          </span>
          <span class="breakdown-score"
            >{{ lawnHealthScore().mowingScore }}/30</span
          >
        </div>
        <div class="breakdown-item">
          <span class="breakdown-label">
            <i class="ti ti-package breakdown-icon"></i>
            Fertilization
          </span>
          <span class="breakdown-score"
            >{{ lawnHealthScore().fertilizationScore }}/25</span
          >
        </div>
        <div class="breakdown-item">
          <span class="breakdown-label">
            <i class="ti ti-calendar-check breakdown-icon"></i>
            Consistency
          </span>
          <span class="breakdown-score"
            >{{ lawnHealthScore().consistencyScore }}/20</span
          >
        </div>
        <div class="breakdown-item">
          <span class="breakdown-label">
            <i class="ti ti-clock breakdown-icon"></i>
            Recency
          </span>
          <span class="breakdown-score"
            >{{ lawnHealthScore().recencyScore }}/25</span
          >
        </div>
      </div>
    </div>
  }
</p-card>
