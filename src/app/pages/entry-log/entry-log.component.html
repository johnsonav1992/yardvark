<div class="main-container">
  <entries-calendar
    [markers]="entryMarkers()"
    [weatherMarkers]="weatherMarkers()"
    [isLoadingData]="entries.isLoading()"
    [mobileDateSelected]="selectedMobileDateToView()"
    [(mode)]="viewMode"
    (monthChange)="changeMonths($event)"
    (daySelected)="selectDay($event)"
    (exportCsv)="exportCsv()"
  >
    <ng-template #marker let-dayMarkers>
      @for (marker of dayMarkers; track marker.id) {
        <div [style.margin-left]="$index !== 0 ? '-.25rem' : ''">
          <p-button
            (click)="navigateToEntry(marker.data.entry)"
            [icon]="marker.icon"
            rounded
            size="small"
            severity="secondary"
            raised
            [dt]="markerButtonDt"
          />
        </div>
      }
    </ng-template>

    <ng-template #weatherMarker let-weatherMarkers>
      @for (marker of weatherMarkers; track marker.id) {
        <weather-day-marker [marker]="marker" />
      }
    </ng-template>
  </entries-calendar>
  @if (isMobile() || viewMode() === "list") {
    <p-divider />
    @if (viewMode() === "list") {
      <div 
        class="list-sort-controls"
        [style]="{
          padding: isMobile() ? '0.5rem 0.75rem 0.25rem 0.75rem' : '0.75rem 1rem 0.5rem 1rem',
          gap: '0.5rem'
        }"
      >
        <span class="sort-label">Sort</span>
        <p-button
          [icon]="entrySortOrder() === 'asc' ? 'ti ti-sort-ascending-2' : 'ti ti-sort-descending-2'"
          severity="secondary"
          outlined
          rounded
          size="large"
          [dt]="sortButtonDt"
          (click)="toggleSortOrder()"
          [pTooltip]="entrySortOrder() === 'asc' ? 'Sort by date: Oldest First' : 'Sort by date: Newest First'"
          tooltipPosition="left"
          [showDelay]="1500"
        />
      </div>
      <div 
        class="list-entries-container" 
[style.paddingBottom]="isMobile() ? '6rem' : '7rem'"
      >
        @for (entry of listViewEntries(); track entry.id) {
          <mobile-entry-preview-card [entry]="entry" />
        } @empty {
          @if (!entries.isLoading()) {
            <p class="small-text">
              No entries for this month. Click the button below to create a new
              entry.
            </p>
          }
        }
      </div>
    } @else if (selectedMobileDateToView()) {
      <div class="list-entries-container">
        @for (
          selectedEntry of selectedMobileDateEntries();
          track selectedEntry.id
        ) {
          <mobile-entry-preview-card [entry]="selectedEntry" />
        } @empty {
          <p class="small-text">
            No entries for this date. Double tap it to add an entry.
          </p>
        }
      </div>
    } @else if (isMobile() && viewMode() !== "list") {
      <p class="small-text">
        Tap on a date to view entries or click the button below to create a new
        entry.
        @if (isMobile()) {
          Double tap a date to create a new entry for that date.
        }
      </p>
    }
  }
  <p-button
    icon="ti ti-clipboard-plus"
    class="speed-dial"
    rounded
    raised
    size="large"
    [dt]="addButtonDt()"
    [pTooltip]="'Create entry'"
    (click)="createEntry()"
  />
</div>
<router-outlet></router-outlet>
