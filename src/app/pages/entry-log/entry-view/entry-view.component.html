@let date = entryData()?.date! | date: "M/dd/yyyy";
@let soilTemp =
  entryData()?.soilTemperature?.toString() +
  "Â° " +
  (entryData()?.soilTemperatureUnit === "fahrenheit" ? "F" : "C");

@let isLoading = entryResource.isLoading();
@let hasAdditionalInfo =
  entryData()?.activities?.length ||
  entryData()?.lawnSegments?.length ||
  entryData()?.products?.length ||
  entryData()?.notes;

<page-container pageTitle="Journal Entry">
  <p-card [dt]="cardDt">
    <ng-template #title>
      <div class="title-container">
        @if (isLoading) {
          <p-skeleton [width]="'100px'" />
          <p-skeleton [width]="'50px'" [height]="'40px'" />
        } @else {
          {{ date }}
          @if (entryData()?.title) {
            <h3>{{ entryData()?.title }}</h3>
          }
          <div style="display: flex; gap: 0.25rem">
            <p-button
              label="Edit"
              icon="ti ti-pencil"
              outlined
              (click)="('')"
              severity="secondary"
            />
            <p-button
              label="Delete"
              icon="ti ti-trash"
              outlined
              (click)="deleteEntry()"
              severity="danger"
            />
          </div>
        }
      </div>
    </ng-template>
    <ng-template #subtitle>
      @if (isLoading) {
        <div
          [style]="{
            display: 'flex',
            gap: '1rem',
            marginTop: '1rem',
            alignItems: 'center'
          }"
        >
          <p-skeleton [width]="'100px'" />
          <p-skeleton [width]="'80px'" height="30px" borderRadius=".75rem" />
        </div>
      } @else {
        @if (entryData()?.soilTemperature) {
          Soil temp:
          <p-chip
            [label]="soilTemp"
            icon="ti ti-thermometer"
            [dt]="soilTempChipDt"
          />
        }
      }
    </ng-template>
    @if (hasAdditionalInfo) {
      <p-divider />
      <div class="content-container">
        @if (isLoading) {
          @for (num of [1, 2, 3]; track num) {
            <p-skeleton [width]="'175px'" height="20px" />
            <p-skeleton [width]="'90px'" />
          }
        } @else {
          @if (activities()?.length) {
            <div class="section-container">
              <h3>Activities:</h3>
              @for (activity of activities(); track activity.id) {
                <p>{{ activity.name }}</p>
              }
            </div>
          }
          @if (entryData()?.lawnSegments?.length) {
            <div class="section-container">
              <h3>Lawn segments:</h3>
              @for (segment of entryData()?.lawnSegments; track segment.id) {
                <p>{{ segment.name }}</p>
              }
            </div>
          }
          @if (entryData()?.notes) {
            <div class="section-container">
              <h3>Notes:</h3>
              {{ entryData()?.notes }}
            </div>
          }
          @if (entryData()?.products?.length) {
            <div class="section-container">
              <h3>Products:</h3>
              <div class="products-wrapper" formArrayName="products">
                @for (
                  product of entryData()?.products;
                  track product.productId
                ) {
                  <div class="product-card">
                    <div class="product-info-wrapper">
                      <img
                        [src]="product?.imageUrl"
                        width="auto"
                        height="30px"
                      />
                      <div>
                        <p>{{ product?.brand }} - {{ product?.name }}</p>
                        <p>
                          {{ product?.quantity }}{{ product?.quantityUnit }}
                        </p>
                      </div>
                    </div>
                    <div class="product-input-wrapper"></div>
                  </div>
                }
              </div>
            </div>
          }
        }
      </div>
    }
    <ng-template #footer> </ng-template>
  </p-card>
</page-container>
