<form
  [formGroup]="form"
  style="display: flex; flex-direction: column; gap: 1rem"
>
  <div
    style="
      display: flex;
      width: 100%;
      justify-content: space-between;
      align-items: center;
    "
  >
    <span style="display: flex">
      <p>Title:</p>
      <small class="error">*</small>
    </span>
    <input pInputText formControlName="title" />
    <span style="display: flex">
      <p>Date:</p>
      <small class="error">*</small>
    </span>
    <p-datePicker [showIcon]="true" formControlName="date" />
  </div>
  Activities:
  <p-multiSelect
    [options]="activities()"
    [optionLabel]="'name'"
    formControlName="activities"
  />
  Lawn Segments:
  <p-multiSelect
    [options]="lawnSegments()"
    formControlName="lawnSegments"
    optionLabel="name"
  />
  Products:
  <p-multiSelect
    #productSelect
    [options]="products.value()"
    optionLabel="name"
    formControlName="products"
    [placeholder]="products.isLoading() ? 'Loading...' : 'Select Products'"
    [loading]="products.isLoading()"
    [showClear]="true"
    (onChange)="productSelect.hide()"
  >
    <ng-template let-product #item>
      <div style="display: flex; gap: 0.5rem; align-items: center">
        <img [src]="product.imageUrl" width="auto" height="30px" />
        <div>
          <p>{{ product.name }}</p>
          <p>{{ product.quantity }}{{ product.quantityUnit }}</p>
        </div>
      </div>
    </ng-template>
    <ng-template let-items #selecteditems>
      @if (items?.length) {
        {{ items.length }} selected
      }
    </ng-template>
  </p-multiSelect>
  @let selectedProducts = form.controls.products.value;

  @if (selectedProducts?.length) {
    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap">
      @for (product of selectedProducts; track product.id) {
        <div
          style="
            display: flex;
            width: 100%;
            align-items: center;
            justify-content: space-between;
            border: 1px dotted #ccc;
            padding: 0.5rem;
            border-radius: 0.25rem;
          "
        >
          <div style="display: flex; gap: 0.5rem; align-items: center">
            <img [src]="product.imageUrl" width="auto" height="30px" />
            <div>
              <p>{{ product.name }}</p>
              <p>{{ product.quantity }}{{ product.quantityUnit }}</p>
            </div>
          </div>
          <div style="display: flex; gap: 0.25rem">
            <p-inputnumber
              [showButtons]="true"
              [min]="0"
              [max]="100"
              [maxFractionDigits]="2"
              mode="decimal"
              [inputStyle]="{ width: '6rem' }"
            />
            <p-select [options]="quantityUnits" />
          </div>
        </div>
      }
    </div>
  }
  Notes:
  <textarea pTextarea [rows]="3" formControlName="notes"></textarea>
</form>
